<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Achievements Wiki | Gemini AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Cargamos la biblioteca. Asegúrate de que los archivos coincidan en la ruta -->
    <script src="logros/biblioteca.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        
        body { 
            background-color: #09090b; 
            color: #fafafa; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 40px 40px;
            overflow-x: hidden;
        }

        .login-card {
            background: rgba(24, 24, 27, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .platform-btn {
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .platform-btn.active-java { border-color: #22c55e; background: rgba(34, 197, 94, 0.05); }
        .platform-btn.active-bedrock { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }

        .achievement-card {
            background: rgba(24, 24, 27, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            border-color: #22c55e;
        }

        #chat-window {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(20px);
            opacity: 0;
            pointer-events: none;
        }

        #chat-window.open {
            transform: translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        .ai-sparkle {
            background: linear-gradient(90deg, #f0abfc, #a855f7, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Pantalla de Login / Configuración -->
    <div id="login-screen" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-[#09090b]">
        <div class="login-card w-full max-w-md p-10 rounded-[3rem] text-center">
            <h2 class="text-4xl font-black uppercase italic tracking-tighter mb-8">Bienvenido <br><span class="text-green-500">Miner</span></h2>
            
            <div class="space-y-4 mb-10 text-left">
                <label class="text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2 block">Selecciona tu Plataforma</label>
                <div class="flex gap-2">
                    <button onclick="selectPlatform('java')" id="btn-java" class="platform-btn flex-1 p-4 rounded-2xl bg-white/5 flex items-center justify-center gap-2">
                        <i data-lucide="coffee" class="w-4 h-4"></i> Java
                    </button>
                    <button onclick="selectPlatform('bedrock')" id="btn-bedrock" class="platform-btn flex-1 p-4 rounded-2xl bg-white/5 flex items-center justify-center gap-2">
                        <i data-lucide="box" class="w-4 h-4"></i> Bedrock
                    </button>
                </div>
            </div>

            <button onclick="enterWiki()" id="enter-btn" disabled class="w-full py-5 bg-white/5 text-gray-500 rounded-2xl font-black uppercase tracking-widest text-sm transition-all">
                Cargar Biblioteca
            </button>
        </div>
    </div>

    <!-- Wiki Principal -->
    <div id="main-content" class="hidden">
        <nav class="sticky top-0 z-40 px-6 py-4 bg-[#09090b]/80 backdrop-blur-md border-b border-white/10">
            <div class="max-w-6xl mx-auto flex justify-between items-center">
                <h1 class="text-xl font-black uppercase italic tracking-tighter">Wiki<span class="text-green-500">Logros</span></h1>
                <div class="flex items-center gap-4">
                    <div class="px-4 py-1.5 rounded-full border border-white/10 text-[10px] font-black uppercase bg-white/5">
                        <span id="platform-text">JAVA</span>
                    </div>
                    <button onclick="logout()" class="p-2 text-gray-500 hover:text-red-500 transition-colors">
                        <i data-lucide="power" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </nav>

        <header class="max-w-6xl mx-auto px-6 mt-12 mb-12 flex flex-col md:flex-row justify-between items-end gap-6">
            <div>
                <h2 class="text-5xl md:text-7xl font-black italic uppercase tracking-tighter mb-4">Base de <span class="text-green-500">Datos</span></h2>
                <p id="welcome-msg" class="text-gray-400 italic font-medium">Selecciona un logro para ver los detalles.</p>
            </div>
            <button onclick="generateDailyChallenge()" class="px-6 py-3 bg-white/5 border border-white/10 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-white/10 transition-all flex items-center gap-2">
                Reto Diario ✨
            </button>
        </header>

        <main class="max-w-6xl mx-auto px-6 pb-24">
            <div id="achievements-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </main>
    </div>

    <!-- Chat Bot IA -->
    <div class="fixed bottom-6 right-6 z-[60]">
        <div id="chat-window" class="bg-[#121214] border border-white/10 w-80 h-96 rounded-3xl mb-4 overflow-hidden flex flex-col shadow-2xl">
            <div class="p-4 bg-green-500 text-black flex justify-between items-center">
                <span class="font-black uppercase italic text-xs tracking-tighter">Asistente Miner ✨</span>
                <button onclick="toggleChat()"><i data-lucide="chevron-down" class="w-4 h-4"></i></button>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-3 text-[11px] leading-relaxed">
                <div class="bg-white/5 p-3 rounded-2xl rounded-tl-none">¡Hola! Pregúntame lo que quieras sobre Minecraft.</div>
            </div>
            <div class="p-4 border-t border-white/5 flex gap-2">
                <input type="text" id="chat-input" placeholder="Preguntar algo..." class="bg-white/5 border border-white/10 rounded-xl px-4 py-2 flex-1 text-xs outline-none focus:border-green-500/50 transition-all">
                <button onclick="askChat()" class="p-2 bg-green-500 text-black rounded-xl">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
        <button onclick="toggleChat()" class="w-14 h-14 bg-green-500 text-black rounded-full flex items-center justify-center shadow-xl transition-all">
            <i data-lucide="message-square-text" class="w-6 h-6"></i>
        </button>
    </div>

    <!-- Modal Detalles -->
    <div id="logroModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-bg absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="bg-[#121214] w-full max-w-2xl rounded-[2.5rem] border border-white/10 relative z-10 overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-8 border-b border-white/5 flex justify-between items-start">
                <h3 id="modalTitle" class="text-3xl font-black italic uppercase tracking-tighter">Título</h3>
                <button onclick="closeModal()" class="text-gray-500"><i data-lucide="x"></i></button>
            </div>
            <div class="p-8 overflow-y-auto space-y-8">
                <div id="ai-result-box" class="hidden p-6 bg-purple-500/5 border border-purple-500/20 rounded-3xl text-sm italic text-purple-200"></div>
                <div>
                    <h5 class="text-[10px] font-black uppercase text-gray-500 mb-4 tracking-widest">Inventario Necesario</h5>
                    <div id="modalInventory" class="flex flex-wrap gap-2"></div>
                </div>
                <div>
                    <h5 class="text-[10px] font-black uppercase text-gray-500 mb-4 tracking-widest">Tutorial</h5>
                    <ul id="modalTutorial" class="space-y-2 text-gray-400 text-sm"></ul>
                </div>
                <button onclick="getAIStrategy()" class="w-full py-4 bg-purple-500/10 border border-purple-500/20 rounded-2xl text-[10px] font-black uppercase tracking-widest text-purple-400 hover:bg-purple-500/20 transition-all">
                    Generar Estrategia IA ✨
                </button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACIÓN INTERNA: Pon tu API Key aquí directamente
        const INTERNAL_GEMINI_KEY = "AIzaSyCqKcDSbnCx3MHwgQGfpdslEUzThhp1CxU"; // El entorno inyectará la clave automáticamente si está configurada

        let apiKey = INTERNAL_GEMINI_KEY; 
        let currentPlatform = null;
        let visibleLogros = [];
        let currentLogroIndex = null;

        function selectPlatform(p) {
            currentPlatform = p;
            document.getElementById('btn-java').className = `platform-btn flex-1 p-4 rounded-2xl bg-white/5 flex items-center justify-center gap-2 ${p === 'java' ? 'active-java' : ''}`;
            document.getElementById('btn-bedrock').className = `platform-btn flex-1 p-4 rounded-2xl bg-white/5 flex items-center justify-center gap-2 ${p === 'bedrock' ? 'active-bedrock' : ''}`;
            const enterBtn = document.getElementById('enter-btn');
            enterBtn.disabled = false;
            enterBtn.className = "w-full py-5 bg-green-500 text-black rounded-2xl font-black uppercase tracking-widest text-sm";
        }

        function enterWiki() {
            localStorage.setItem('mc_session_platform', currentPlatform);
            checkSession();
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }

        function checkSession() {
            const platform = localStorage.getItem('mc_session_platform');
            if (platform) {
                currentPlatform = platform;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('platform-text').innerText = platform.toUpperCase();
                renderLogros(platform);
            }
            lucide.createIcons();
        }

        function renderLogros(platform) {
            const grid = document.getElementById('achievements-grid');
            const source = window.bibliotecaLogros || [];
            
            visibleLogros = source.filter(logro => {
                if (logro.Else) return true;
                if (platform === 'java' && logro.Java) return true;
                if (platform === 'bedrock' && logro.Bedrock) return true;
                return false;
            });

            if(visibleLogros.length === 0) {
                grid.innerHTML = `<p class="col-span-full text-center text-gray-500 py-20 italic">No hay logros cargados en la biblioteca...</p>`;
                return;
            }

            grid.innerHTML = visibleLogros.map((logro, index) => `
                <div onclick="openModal(${index})" class="achievement-card p-8 rounded-[2rem] flex flex-col">
                    <h4 class="text-2xl font-black italic uppercase mb-2 tracking-tighter">${logro.name}</h4>
                    <p class="text-gray-400 text-sm mb-6 font-medium italic">${logro.categoria}</p>
                    <div class="mt-auto pt-6 border-t border-white/5 flex justify-between items-center text-[9px] font-black uppercase text-gray-500">
                        <span>${logro.dificultad}</span>
                        <span>${logro.Else ? 'Global' : 'Exclusivo'}</span>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- GEMINI API CON MANEJO DE RETINTOS ---
        async function callGemini(prompt, systemPrompt = "Eres un experto en Minecraft. Responde solo texto plano, muy directo, sin Markdown, sin asteriscos ni almohadillas.") {
            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });
                    
                    if (!response.ok) throw new Error("Retry");

                    const data = await response.json();
                    let text = data.candidates?.[0]?.content?.parts?.[0]?.text || "No hay respuesta.";
                    // Limpieza agresiva de caracteres especiales
                    return text.replace(/[#*`´_]/g, '').trim();
                } catch (error) {
                    if (i === 4) return "La IA está saturada. Inténtalo de nuevo en un momento.";
                    await new Promise(r => setTimeout(r, delay));
                    delay *= 2;
                }
            }
        }

        async function getAIStrategy() {
            const box = document.getElementById('ai-result-box');
            const logro = visibleLogros[currentLogroIndex];
            box.classList.remove('hidden');
            box.innerText = "Analizando estrategia...";
            const res = await callGemini(`Dame una estrategia de una frase para el logro: ${logro.name}`);
            box.innerText = res;
        }

        async function askChat() {
            const input = document.getElementById('chat-input');
            const chatBox = document.getElementById('chat-messages');
            const text = input.value.trim();
            if(!text) return;

            chatBox.innerHTML += `<div class="bg-green-500/10 p-3 rounded-2xl text-right ml-8">${text}</div>`;
            input.value = "";
            
            const response = await callGemini(text);
            chatBox.innerHTML += `<div class="bg-white/5 p-3 rounded-2xl mr-8 border border-white/10">${response}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function generateDailyChallenge() {
            const res = await callGemini("Genera un mini reto de Minecraft de 5 palabras.");
            document.getElementById('welcome-msg').innerHTML = `<span class="text-green-500 uppercase font-black">RETO:</span> ${res}`;
        }

        function toggleChat() { document.getElementById('chat-window').classList.toggle('open'); }
        function closeModal() { document.getElementById('logroModal').classList.add('hidden'); }
        
        function openModal(i) {
            currentLogroIndex = i;
            const l = visibleLogros[i];
            document.getElementById('modalTitle').innerText = l.name;
            document.getElementById('modalInventory').innerHTML = (l.inventoryNed || []).map(item => `<span class="bg-white/5 border border-white/10 px-3 py-1.5 rounded-xl text-[10px] font-bold text-gray-400 uppercase">${item}</span>`).join('');
            document.getElementById('modalTutorial').innerHTML = (l.tutorial || []).map(s => `<li>• ${s}</li>`).join('');
            document.getElementById('ai-result-box').classList.add('hidden');
            document.getElementById('logroModal').classList.remove('hidden');
            lucide.createIcons();
        }

        window.onload = checkSession;
    </script>
</body>
</html>
